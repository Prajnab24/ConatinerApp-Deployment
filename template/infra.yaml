steps:
- task: UseTerraform@0
  inputs:
    terraformVersion: '1.5.0' 

- task: AzureCLI@2
  displayName: 'Azure Login'
  inputs:
    azureSubscription: 'azure-connection' # Authenticate with Azure using service connection

- task: TerraformInstaller@0
  displayName: 'Install Terraform'
  inputs:
    terraformVersion: '1.5.0' 

- script: |
    terraform init 
  displayName: 'Terraform Init'

- script: |
    terraform plan \
      -out=tfplan \
      -input=false
  displayName: 'Terraform Plan'

- script: |
    terraform apply \
      -input=false \
      -auto-approve tfplan
  displayName: 'Terraform Apply'
